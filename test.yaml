kubectl patch configmap argocd-cm -n argocd --type merge -p '
data:
  resource.customizations.actions.batch_Job: |
    discovery.lua: |
      actions = {}
      if obj.metadata.labels and obj.metadata.labels["argocd.custom-action/retryable"] == "true" then
        actions["retry"] = {
          name = "Retry Job",
          title = "Retry",
          disabled = false
        }
      end
      return actions
    definitions:
    - name: retry
      action.lua: |
        local os = require("os")
        local newObj = {}
        newObj.apiVersion = obj.apiVersion
        newObj.kind = obj.kind
        newObj.metadata = {}
        newObj.metadata.name = obj.metadata.name .. "-retry-" .. os.time()
        newObj.metadata.namespace = obj.metadata.namespace
        newObj.metadata.labels = obj.metadata.labels
        newObj.spec = obj.spec
        newObj.spec.selector = nil
        newObj.spec.template.metadata.labels["controller-uid"] = nil
        return {
          k8s = {
            version = "batch/v1",
            kind = "Job",
            operation = "create",
            resource = newObj
          }
        }
'