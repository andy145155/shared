Here is a draft for the **"New ArgoCD Application"** section of your design document. It formalizes the "Umbrella Chart" approach we discussed and specifies the exact file paths.

You can copy and paste this directly into your Confluence doc.

---

## **New ArgoCD Application: cf-automation**

To ensure clear ownership and isolation of Core Foundation (CF) operations, we will introduce a new ArgoCD application dedicated to the `cybsecops` cluster. This application acts as an "Umbrella Chart," managing the `aws-config-report-generator` and serving as a home for future CF-related automation jobs.

### **1. Application Structure & Location**

The application source code will be nested directly within the `cybsecops` cluster configuration to enforce cluster-specific isolation.

* **App Name:** `cf-automation`
* **Target Cluster:** `cybsecops` (Productive & Non-Productive)
* **Target Namespace:** `cf-automation`
* **Repository Path:** `apps/clusters/cybsecops/cf-automation`

### **2. Repository File Hierarchy**

We will implement a split-config pattern where the ArgoCD "Manager" manifest lives in the cluster templates, while the actual application logic (the "Source") resides in a nested folder.

```text
apps/
└── clusters/
    └── cybsecops/
        ├── templates/
        │   └── cf-automation.yaml       # <--- The ArgoCD Application Manifest
        │
        └── cf-automation/               # <--- The Source Code (Umbrella Chart)
            ├── Chart.yaml
            ├── values.yaml
            └── templates/
                ├── aws-config-report.yaml    # <--- Our Compliance Service
                └── (future-cf-service).yaml  # <--- Future jobs go here

```

### **3. Application Manifest Specification**

**File:** `apps/clusters/cybsecops/templates/cf-automation.yaml`

```yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: {{ .Values.mox.cluster.name }}.cf-automation
  annotations:
    argocd.argoproj.io/sync-wave: "2"
  labels:
    cluster: {{ .Values.mox.cluster.name }}
    app: cf-automation
    part-of: cluster
    owner: core-foundation
spec:
  project: default
  destination:
    name: {{ .Values.mox.argocd.cluster }}
    namespace: cf-automation
  syncPolicy:
    automated: {}
    syncOptions:
      - ApplyOutOfSyncOnly=true
      - CreateNamespace=true  # Automatically creates the 'cf-automation' namespace
  source:
    repoURL: https://github.com/ProjectDrgn/argocd-apps
    # Points to the internal nested folder
    path: apps/clusters/cybsecops/cf-automation
    targetRevision: {{ .Values.mox.argocd.branch }}
    plugin:
      name: mox
      env:
        - name: helm
          value: |
            releaseName: cf-automation
            values:
              awsConfigReport:
                enabled: true

```