Here is a comprehensive Jira ticket template based on your situation. It frames the issue as an investigation into a reliable solution, acknowledging that the current "internal curl" method is problematic.

**Title:** [SPIKE] Investigate and Implement Reliable Istio Ingress Verification for ArgoCD Pipeline

**Type:** Task / Spike
**Priority:** High
**Labels:** `istio`, `automation`, `argocd`, `quality-assurance`

---

### **Description**

**Context:**
We currently rely on a Python automation script to verify Istio Ingress functionality during our release pipeline. The current implementation runs inside the cluster and attempts to verify connectivity by `exec`-ing into a client pod and running `curl` against the `istio-ingressgateway` **internal ClusterIP** using the `--resolve` flag (forcing the host to resolve to the internal IP).

**The Problem:**
This "internal hairpin" approach is failing consistently in the **App Cluster**. The test fails during the TLS handshake with the error:

> `curl: (35) TLS connect error: error:0A000126:SSL routines::unexpected eof while reading`

This indicates that traffic originating from inside the mesh, targeted at the Ingress Gateway service IP, is conflicting with the sidecar/Envoy mTLS configuration or TLS termination logic.

**Objective:**
Investigate a robust and "correct" method for verifying Ingress functionality that simulates real-world usage (North-South traffic) and integrate it into our ArgoCD pipeline (e.g., as a PostSync hook).

### **Investigation Scope**

1. **Root Cause Analysis (Current Method):**
* Confirm if the `unexpected eof` is caused by Envoy sidecar interception (mTLS vs. TLS conflict) when targeting the Ingress Service ClusterIP.
* Determine if this internal verification method should be deprecated entirely in favor of external checks.


2. **Explore Alternative Verification Strategies:**
* **Option A (External Check):** Can the test run from a context that has access to the external LoadBalancer IP / DNS? (True North-South test).
* **Option B (Loopback w/o Sidecar):** Can the test run in a pod *without* an Istio sidecar to avoid mTLS interference?
* **Option C (Gateway Hairpinning):** Is there a specific Istio `Gateway` configuration required to allow internal services to route to the Gateway's public IP effectively?


3. **ArgoCD Integration:**
* Ensure the chosen solution can run as a standardized ArgoCD Hook (Job) or within the existing Python automation framework.



### **Acceptance Criteria**

* [ ] Root cause of the App Cluster TLS failure is documented.
* [ ] A decision is made: Fix the internal test OR replace it with an external verification pattern.
* [ ] A working Proof of Concept (POC) script is created that successfully verifies:
* [ ] Route availability (Status 200).
* [ ] TLS handshake success.
* [ ] Correct routing to the target backend.


* [ ] The solution is compatible with the current ArgoCD pipeline.

### **Technical Notes & Resources**

* **Current Error:** `error:0A000126:SSL routines::unexpected eof while reading`
* **Current Command:**
```bash
curl -k --resolve <HOST>:443:<INTERNAL_CLUSTER_IP> https://<HOST>/status/200

```


* **Repo:** [Link to your repo/script]
* **Logs:** See attached screenshot of failure in App Cluster.