Here is the updated Jira ticket. I have updated the **Tasks** and **Technical Approach** sections to reflect your strategy of using specific Docker images for each step rather than building a complex CLI tool structure.

***

**Title:** Refactor Istio Verification Pipeline: Modularize into "Fail-Fast" ArgoCD Hooks

**Description**

**User Story**
As a Platform Engineer, I want to split the current monolithic Istio verification job into separate Dockerized jobs triggered by ArgoCD hooks. This allows us to "fail fast" during upgrades and prevents broken sidecars from reaching production.

**The Problem: "Verify at the End"**
Currently, verification runs only *after* the entire upgrade (Control Plane sync + Workload restart) is complete.
* **Risk:** If `istiod` is unhealthy, we don't catch it until thousands of pods have already restarted, causing potential downtime.
* **Toil:** Requires manual triggering of the monolithic script.

**The Solution: "Fail-Fast" Pipeline**
We will implement a staged verification pipeline using ArgoCD Hooks and specific Docker images for each check.

1.  **Stage 1: Pre-Flight (Safety)**
    * **Hook:** `PreSync` on `istiod` App.
    * **Image:** `istio/istioctl` (Official Image)
    * **Task:** Run `istioctl x precheck`. Aborts if incompatible.
2.  **Stage 2: Control Plane (Gatekeeper)**
    * **Hook:** `PostSync` on `istiod` App.
    * **Image:** `af-toolkit-controlplane` (or specific tag)
    * **Task:** Verifies deployment status and proxy health. If this fails, **workloads are NOT restarted.**
3.  **Stage 3: Data Plane (Final Check)**
    * **Hook:** `PostSync` on `sequential-restart` App.
    * **Image:** `af-toolkit-dataplane` (or specific tag)
    * **Task:** Verifies mTLS and header logic *after* the restart completes.

---

**Acceptance Criteria**

1.  **Pre-Check Gating:** If `istioctl x precheck` fails, the sync must **abort immediately**.
2.  **Control Plane Gating:** If the Control Plane image/job fails, the pipeline stops. The downstream restart job must **not** run.
3.  **Data Plane Verification:** mTLS and header checks run automatically only **after** the application restart job completes.
4.  **Containerization:** Verification logic is separated into distinct Docker images/tags referenced by the ArgoCD Job manifests.

**Tasks**
* [ ] Create/Build Docker image for Control Plane verification (logic from `verify_controlplane.py`).
* [ ] Create/Build Docker image for Data Plane verification (logic from `check_mtls.py`, `check_retry_after.py`).
* [ ] Create `PreSync` job manifest using the official `istioctl` image.
* [ ] Update ArgoCD Application manifests to reference these new images in Hook Jobs.