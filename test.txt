Here is the updated Jira ticket. I have removed the investigation into the old method and refocused the ticket on **designing a replacement**.

---

**Title:** Design and Implement Reliable Istio Ingress Verification for ArgoCD Pipeline

**Type:** Story / Task
**Priority:** High
**Labels:** `istio`, `automation`, `argocd`, `design`

---

### **Description**

**Context:**
We are deprecating our current Ingress verification method (`run_ingress_tests`), which relies on an internal "hairpin" technique (exec-ing into a pod and `curl`-ing the Ingress Gateway's **internal ClusterIP**). This method is technically incorrect for testing Ingress (North-South traffic) and has proven unreliable in our App Cluster, failing with TLS handshake errors due to sidecar/mesh conflicts.

**Objective:**
We need to design a robust, "correct" verification strategy that simulates real external user traffic. This new test will replace the deprecated function and must be integrated into our automation pipeline (likely as an ArgoCD PostSync hook).

**Goal:**
Create a **Design Document** outlining a new Ingress verification approach that validates:

1. **Public/External Connectivity:** Ensuring the Ingress Gateway is reachable via its external LoadBalancer/DNS.
2. **TLS Termination:** Verifying certificates are served correctly.
3. **Routing Rules:** Confirming `VirtualService` and `Gateway` configurations route traffic to the correct backend.

### **Scope of Work**

1. **Research Valid Verification Patterns:**
* Evaluate options for running tests from "outside" the mesh (e.g., a standalone runner, a Lambda function, or a pod explicitly excluded from the mesh).
* Determine how to safely target the external LoadBalancer IP from within our CI/CD environment.


2. **ArgoCD Integration Strategy:**
* Define how this test will run as a PostSync hook.
* Define success/failure criteria (e.g., specific HTTP codes, timeout handling).


3. **Create Design Document:**
* Draft a document detailing the proposed architecture, required permissions, and implementation steps.



### **Acceptance Criteria**

* [ ] **Design Document Created:** A finalized design doc is reviewed and approved by the team.
* *Must include:* Diagram of traffic flow for the test (Source -> LoadBalancer -> Gateway -> Pod).


* [ ] **Deprecation Plan:** Confirmation that the old internal `curl` method will be removed.
* [ ] **Feasibility Check:** The proposed solution is verified to work with our specific network policies and ArgoCD setup.

### **Technical Notes**

* **Deprecated Method:** `curl --resolve ... <ClusterIP>` (Do not use).
* **Target State:** The test should reflect a true client request entering the cluster via the external LoadBalancer.